var Q=Object.defineProperty;var B=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var F=(m,r,a)=>r in m?Q(m,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[r]=a,O=(m,r)=>{for(var a in r||(r={}))D.call(r,a)&&F(m,a,r[a]);if(B)for(var a of B(r))G.call(r,a)&&F(m,a,r[a]);return m};import{x as $,G as M,H as b,Y as H,Z as X,$ as Z,A as p,X as K,B as o,r as y,w as W,ak as ee,y as T,C as f,N as i,az as se,ab as te,I,a8 as V,aN as oe,J as re,d as ne,s as ae,a as le,k,ax as ie,j as R,a0 as de,L as ue,M as ce,at as pe,O as j}from"./frappe-ui-C1kNCtW7.js";import{B as me}from"./editorjs-D5YadEn0.js";import{j as _e,P as ve,D as he,a4 as fe,a1 as U,g as be,c as ye,u as ge,b as xe}from"./index-z00NSwZC.js";const we="/assets/lms/frontend/Youtube.mov",Ce=o("div",{class:"absolute left-0 mt-3 w-[35rem] max-w-lg -translate-x-1/2 transform rounded-lg bg-white px-4 sm:px-0 lg:max-w-3xl"},[o("div",{class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},[o("video",{controls:"",autoplay:"",muted:"",width:"100%",controlsList:"nodownload",oncontextmenu:"return false;",class:"rounded-sm"},[o("source",{src:we,type:"video/mp4"})])])],-1),Ne={__name:"YouTubeExplanation",setup(m){return(r,a)=>($(),M(p(K),{transition:"default"},{target:b(({isOpen:g,togglePopover:h})=>[H(r.$slots,"default",X(Z({isOpen:g,togglePopover:h})))]),body:b(()=>[Ce]),_:3}))}},$e={class:"text-lg font-semibold"},Le={class:"mt-5 space-y-4"},Ee={class:""},ke={class:"text-xs text-gray-600 mb-1"},ze={class:"flex"},Se={class:""},qe={class:"text-xs text-gray-600 mb-1"},Te={class:"flex"},Ie={class:""},Ve={key:1,class:""},Pe={class:"flex items-center"},Be={class:"border rounded-md p-2 mr-2"},Fe={class:"flex flex-col"},Oe={class:"text-xs"},Re={class:""},je={class:"text-xs text-gray-600 mb-1"},Ue=["onClick"],Me={__name:"LessonPlugins",props:{editor:{required:!0},notesEditor:{required:!0}},setup(m){const r=y(null),a=y(null),g=y(null),h=y(null),x=y("Lesson Content"),d=m,L=l=>{w().caret.setToLastBlock("end",0),l&&(w().blocks.insert("quiz",{quiz:l}),r.value=null)},c=l=>{w().caret.setToLastBlock("end",0),w().blocks.insert("upload",l)},u=l=>{let _=l.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","mp4","mov","mp3","pdf"].includes(_))return"Only image and video files are allowed."},z=()=>[{label:"Lesson Content",value:"Lesson Content"},{label:"Instructor Content",value:"Instructor Content"}],w=()=>x.value=="Lesson Content"?g.value:h.value;return W(()=>[d.editor,d.notesEditor],([l,_],[E,v])=>{g.value=l,h.value=_}),(l,_)=>{const E=ee("router-link");return $(),T(re,null,[o("div",$e,f(l.__("Components")),1),o("div",Le,[i(p(te),{text:l.__("Content such as quiz, video and image will be added in the editor you select."),placement:"bottom"},{default:b(()=>[o("div",Ee,[o("div",ke,f(l.__("Select an Editor")),1),i(p(se),{modelValue:x.value,"onUpdate:modelValue":_[0]||(_[0]=v=>x.value=v),options:z()},null,8,["modelValue","options"])])]),_:1},8,["text"]),o("div",ze,[i(_e,{value:r.value,class:"flex-1",doctype:"LMS Quiz",label:l.__("Add an existing quiz"),onChange:_[1]||(_[1]=v=>L(v))},null,8,["value","label"]),i(E,{to:{name:"QuizCreation",params:{quizID:"new"}},class:"self-end ml-2"},{default:b(()=>[i(p(I),null,{icon:b(()=>[i(p(ve),{class:"h-4 w-4 stroke-1.5"})]),_:1})]),_:1})]),o("div",Se,[o("div",qe,f(l.__("Add an image, video, pdf or audio.")),1),o("div",Te,[a.value?($(),T("div",Ve,[o("div",Pe,[o("div",Be,[i(p(he),{class:"h-4 w-4 stroke-1.5 text-gray-700"})]),o("div",Fe,[o("span",Oe,f(a.value.file_name),1)])])])):($(),M(p(oe),{key:0,fileTypes:["image/*","video/*","audio/*",".pdf"],validateFile:u,onSuccess:_[2]||(_[2]=v=>c(v))},{default:b(({file:v,progress:C,uploading:N,openFileSelector:S})=>[o("div",Ie,[i(p(I),{onClick:S,loading:N},{default:b(()=>[V(f(N?l.__("Uploading {0}%").format(C):l.__("Upload a File")),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])]),o("div",Re,[o("div",je,f(l.__("To add a YouTube video, paste the URL of the video in the editor.")),1),i(Ne,null,{default:b(({togglePopover:v})=>[o("div",{onClick:C=>v(),class:"flex items-center text-sm underline cursor-pointer"},[i(p(fe),{class:"w-3 h-3 stroke-1.5 text-gray-700 mr-1"}),V(" "+f(l.__("Learn More")),1)],8,Ue)]),_:1})])])],64)}}},Je={class:""},Ae={class:"grid md:grid-cols-[75%,25%] h-screen"},Ye={class:"border-r"},Qe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b overflow-hidden bg-white px-3 py-2.5 sm:px-5"},De={class:"py-5"},Ge={class:"w-5/6 mx-auto"},He={class:"border-t mt-4"},Xe={class:"w-5/6 mx-auto pt-4"},Ze={class:"block font-medium text-gray-600 mb-1"},Ke={id:"instructor-notes",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-gray-300 prose-th:border-gray-300 prose-td:relative prose-th:relative prose-th:bg-gray-100 prose-sm max-w-none !whitespace-normal py-3"},We={class:"border-t mt-4"},es={class:"w-5/6 mx-auto pt-4"},ss={class:"block font-medium text-gray-600 mb-1"},ts=o("div",{id:"content",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-gray-300 prose-th:border-gray-300 prose-td:relative prose-th:relative prose-th:bg-gray-100 prose-sm max-w-none !whitespace-normal py-3"},null,-1),os={class:""},rs={class:"sticky top-0 p-5"},ds={__name:"LessonForm",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(m){const r=y(null),a=y(null),g=ne("$user"),h=y(!1);let x;const d=m;ae(()=>{var e,s;!((e=g.data)!=null&&e.is_moderator)&&!((s=g.data)!=null&&s.is_instructor)&&(window.location.href="/login"),U("lesson_form_opened"),r.value=L("content"),a.value=L("instructor-notes")});const L=e=>new me({holder:e,tools:be(),autofocus:!0}),c=le({title:"",include_in_preview:!1,body:"Test",instructor_notes:"",content:""}),u=k({url:"lms.lms.utils.get_lesson_creation_details",params:{course:d.courseName,chapter:d.chapterNumber,lesson:d.lessonNumber},auto:!0,onSuccess(e){e.lesson&&(Object.keys(e.lesson).forEach(s=>{c[s]=e.lesson[s]}),c.include_in_preview=!!e.include_in_preview,z(e),w(e),l())}}),z=e=>{r.value.isReady.then(()=>{if(e.lesson.content)r.value.render(JSON.parse(e.lesson.content));else if(e.lesson.body){let s=C(e.lesson);r.value.render({blocks:s})}})},w=e=>{a.value.isReady.then(()=>{if(e.lesson.instructor_content)a.value.render(JSON.parse(e.lesson.instructor_content));else if(e.lesson.instructor_notes){let s=C(e.lesson);a.value.render({blocks:s})}})},l=()=>{x=setInterval(()=>{N()},5e3)};ie(()=>{clearInterval(x)});const _=k({url:"frappe.client.insert",makeParams(e){var s;return{doc:O({doctype:"Course Lesson",course:d.courseName,chapter:(s=u.data)==null?void 0:s.chapter.name},c)}}}),E=k({url:"frappe.client.set_value",makeParams(e){return{doctype:"Course Lesson",name:e.lesson,fieldname:c}}}),v=k({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"Lesson Reference",parent:(s=u.data)==null?void 0:s.chapter.name,parenttype:"Course Chapter",parentfield:"lessons",lesson:e.lesson,idx:d.lessonNumber}}}}),C=e=>{let s=[];if(e.youtube){let t=e.youtube.split("/").pop();s.push({type:"embed",data:{service:"youtube",embed:`https://www.youtube.com/embed/${t}`}})}return e.body.split(`
`).forEach(t=>{if(t.includes("{{ YouTubeVideo")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];n.includes("https://")||(n=`https://www.youtube.com/embed/${n}`),s.push({type:"embed",data:{service:"youtube",embed:n}})}else if(t.includes("{{ Quiz")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"quiz",data:{quiz:n}})}else if(t.includes("{{ Video")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"video"}})}else if(t.includes("{{ Audio")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"audio"}})}else if(t.includes("{{ PDF")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"pdf"}})}else if(t.includes("{{ Embed")){let n=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"embed",data:{service:n.split("|||")[0],embed:n.split("|||")[1]}})}else if(t.includes("![]")){let n=t.match(/\((.*?)\)/)[1];s.push({type:"upload",data:{file_url:n,file_type:"image"}})}else if(t.includes("#")){let n=(t.match(/#/g)||[]).length;s.push({type:"header",data:{text:t.replace(/#/g,"").trim(),level:n}})}else s.push({type:"paragraph",data:{text:t}})}),e.quizId&&s.push({type:"quiz",data:{quiz:e.quizId}}),s},N=()=>{r.value.save().then(e=>{c.content=JSON.stringify(e),a.value.save().then(s=>{var t;c.instructor_content=JSON.stringify(s),(t=u.data)!=null&&t.lesson?J():S()})})},S=()=>{_.submit({},{validate(){return P()},onSuccess(e){v.submit({lesson:e.name},{onSuccess(){U("lesson_created"),q("Success","Lesson created successfully","check"),u.reload()}})},onError(e){q("Error",e.message,"x")}})},J=()=>{E.submit({lesson:u.data.lesson.name},{validate(){return P()},onError(e){q("Error",e.message,"x")}})},P=()=>{if(!c.title)return"Title is required";if(!c.content)return"Content is required"},q=(e,s,t)=>{ye({title:e,text:s,icon:t,iconClasses:t=="check"?"bg-green-600 text-white rounded-md p-px":"bg-red-600 text-white rounded-md p-px",position:t=="check"?"bottom-right":"top-center",timeout:t=="check"?5:10})},A=R(()=>{var s,t,n;let e=[{label:"Courses",route:{name:"Courses"}},{label:(s=u.data)==null?void 0:s.course_title,route:{name:"CourseDetail",params:{courseName:d.courseName}}}];return(t=u==null?void 0:u.data)!=null&&t.lesson&&e.push({label:u.data.lesson.title,route:{name:"Lesson",params:{courseName:d.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}}),e.push({label:(n=u==null?void 0:u.data)!=null&&n.lesson?"Edit Lesson":"Create Lesson",route:{name:"LessonForm",params:{courseName:d.courseName,chapterNumber:d.chapterNumber,lessonNumber:d.lessonNumber}}}),e}),Y=R(()=>({title:"Lesson Editor",description:"Create and edit lessons for your course"}));return ge(Y),(e,s)=>($(),T("div",Je,[o("div",Ae,[o("div",Ye,[o("header",Qe,[i(p(pe),{class:"text-ellipsis",items:A.value},null,8,["items"]),i(p(I),{variant:"solid",onClick:s[0]||(s[0]=t=>N()),class:"mt-3 md:mt-0"},{default:b(()=>[V(f(e.__("Save")),1)]),_:1})]),o("div",De,[o("div",Ge,[i(p(j),{modelValue:c.title,"onUpdate:modelValue":s[1]||(s[1]=t=>c.title=t),label:"Title",class:"mb-4"},null,8,["modelValue"]),i(p(j),{modelValue:c.include_in_preview,"onUpdate:modelValue":s[2]||(s[2]=t=>c.include_in_preview=t),type:"checkbox",label:"Include in Preview"},null,8,["modelValue"])]),o("div",He,[o("div",Xe,[o("div",{class:"flex justify-between cursor-pointer",onClick:s[3]||(s[3]=()=>{h.value=!h.value})},[o("label",Ze,f(e.__("Instructor Notes")),1),i(p(xe),{class:de(["stroke-2 h-5 w-5 text-gray-600",{"rotate-90 transform duration-200":h.value,"duration-200":!h.value}])},null,8,["class"])]),ue(o("div",Ke,null,512),[[ce,h.value]])])]),o("div",We,[o("div",es,[o("label",ss,f(e.__("Content")),1),ts])])])]),o("div",os,[o("div",rs,[i(Me,{editor:r.value,notesEditor:a.value},null,8,["editor","notesEditor"])])])])]))}};export{ds as default};
//# sourceMappingURL=LessonForm-BkhDVHay.js.map
